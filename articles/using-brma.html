<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Conducting a Bayesian Regularized Meta-analysis â€¢ pema</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Conducting a Bayesian Regularized Meta-analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pema</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/meta-analysis_tutorial.html">Tutorial: Machine Learning-Informed Meta-Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/using-brma.html">Conducting a Bayesian Regularized Meta-analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cjvanlissa/pema/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Conducting a Bayesian Regularized Meta-analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cjvanlissa/pema/blob/master/vignettes/using-brma.Rmd" class="external-link"><code>vignettes/using-brma.Rmd</code></a></small>
      <div class="d-none name"><code>using-brma.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>First, load in the necessary packages. In addition, if you are
running the model locally on a multi-core machine, you can set
<code>options(mc.cores = 4)</code>. This ensures the different MCMC
chains will be run in parallel, making estimation faster.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cjvanlissa/pema" class="external-link">pema</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cjvanlissa.github.io/tidySEM/" class="external-link">tidySEM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>In this application, we will work with the bonapersona data
(Bonapersona et al., 2019). The data and codebook can be found <a href="https://zenodo.org/record/2540657#.XEGPP2ko9aR" class="external-link">here</a>. First,
we read in the data and make sure all relevant variables are of the
correct type.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">descriptives</span><span class="op">(</span><span class="va">bonapersona</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"type"</span>, <span class="st">"n"</span>, <span class="st">"unique"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"v"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                    name      type   n unique     mean     sd     v</span></span>
<span><span class="co">#&gt; 1                   exp   integer 734    411  222.644 111.88    NA</span></span>
<span><span class="co">#&gt; 2                    id   integer 734    212   99.402  60.03    NA</span></span>
<span><span class="co">#&gt; 3                author character 734    209       NA     NA 0.990</span></span>
<span><span class="co">#&gt; 4                  year   integer 734     21 2011.014   4.45    NA</span></span>
<span><span class="co">#&gt; 5               journal character 734     69       NA     NA 0.945</span></span>
<span><span class="co">#&gt; 6               species    factor 734      3       NA     NA 0.433</span></span>
<span><span class="co">#&gt; 7         strainGrouped    factor 734     15       NA     NA 0.762</span></span>
<span><span class="co">#&gt; 8                origin    factor 734      4       NA     NA 0.617</span></span>
<span><span class="co">#&gt; 9                   sex    factor 734      3       NA     NA 0.373</span></span>
<span><span class="co">#&gt; 10              ageWeek   numeric 721     25   13.333   5.75    NA</span></span>
<span><span class="co">#&gt; 11                model    factor 734      6       NA     NA 0.667</span></span>
<span><span class="co">#&gt; 12           mTimeStart   integer 734     12    2.357   2.51    NA</span></span>
<span><span class="co">#&gt; 13             mTimeEnd   integer 734     18   12.802   4.39    NA</span></span>
<span><span class="co">#&gt; 14            mHoursAve   numeric 734     33   54.076  47.73    NA</span></span>
<span><span class="co">#&gt; 15         mCageGrouped    factor 734      4       NA     NA 0.485</span></span>
<span><span class="co">#&gt; 16           mLDGrouped    factor 734      5       NA     NA 0.469</span></span>
<span><span class="co">#&gt; 17          mRepetition    factor 734      7       NA     NA 0.446</span></span>
<span><span class="co">#&gt; 18      mControlGrouped    factor 734      4       NA     NA 0.069</span></span>
<span><span class="co">#&gt; 19          hit2Grouped    factor 734      3       NA     NA 0.493</span></span>
<span><span class="co">#&gt; 20    testAuthorGrouped    factor 734     27       NA     NA 0.894</span></span>
<span><span class="co">#&gt; 21        testLDGrouped    factor 734      4       NA     NA 0.295</span></span>
<span><span class="co">#&gt; 22     varAuthorGrouped    factor 734     47       NA     NA 0.914</span></span>
<span><span class="co">#&gt; 23               waterT    factor 734      9       NA     NA 0.125</span></span>
<span><span class="co">#&gt; 24           waterTcate    factor 734      5       NA     NA 0.123</span></span>
<span><span class="co">#&gt; 25         freezingType    factor 734     10       NA     NA 0.221</span></span>
<span><span class="co">#&gt; 26     retentionGrouped    factor 734      5       NA     NA 0.520</span></span>
<span><span class="co">#&gt; 27     directionGrouped    factor 734      5       NA     NA 0.648</span></span>
<span><span class="co">#&gt; 28 effectSizeCorrection   integer   5      2    1.000   0.00    NA</span></span>
<span><span class="co">#&gt; 29               cut_nC   integer  37      2    1.000   0.00    NA</span></span>
<span><span class="co">#&gt; 30         n_notRetriev   integer   5      2    1.000   0.00    NA</span></span>
<span><span class="co">#&gt; 31                   nC   numeric 734     25   10.719   4.07    NA</span></span>
<span><span class="co">#&gt; 32                meanC   numeric 734    412  167.110 112.13    NA</span></span>
<span><span class="co">#&gt; 33                  sdC   numeric 734    499   73.919  62.43    NA</span></span>
<span><span class="co">#&gt; 34                  seC   numeric 734    209   23.314  19.61    NA</span></span>
<span><span class="co">#&gt; 35                   nE   numeric 734     25   11.200   4.15    NA</span></span>
<span><span class="co">#&gt; 36                meanE   numeric 734    430  163.209 114.28    NA</span></span>
<span><span class="co">#&gt; 37                  sdE   numeric 734    500   76.684  62.99    NA</span></span>
<span><span class="co">#&gt; 38                  seE   numeric 734    206   23.554  19.54    NA</span></span>
<span><span class="co">#&gt; 39             dataFrom    factor 734      4       NA     NA 0.288</span></span>
<span><span class="co">#&gt; 40        seqGeneration    factor 734      3       NA     NA 0.487</span></span>
<span><span class="co">#&gt; 41             baseline    factor 734      4       NA     NA 0.412</span></span>
<span><span class="co">#&gt; 42           allocation    factor 734      3       NA     NA 0.170</span></span>
<span><span class="co">#&gt; 43              housing    factor 734      2       NA     NA 0.000</span></span>
<span><span class="co">#&gt; 44             blindExp    factor 734      4       NA     NA 0.429</span></span>
<span><span class="co">#&gt; 45              control    factor 734      4       NA     NA 0.043</span></span>
<span><span class="co">#&gt; 46               outAss    factor 734      4       NA     NA 0.456</span></span>
<span><span class="co">#&gt; 47             outBlind    factor 734      5       NA     NA 0.654</span></span>
<span><span class="co">#&gt; 48              incData    factor 734      3       NA     NA 0.219</span></span>
<span><span class="co">#&gt; 49            waterTNum   numeric  48      8   22.292   1.37    NA</span></span>
<span><span class="co">#&gt; 50                 each   integer 734    734  367.500 212.03    NA</span></span>
<span><span class="co">#&gt; 51          mTimeLength   integer 734     19   10.446   5.61    NA</span></span>
<span><span class="co">#&gt; 52 speciesStrainGrouped    factor 734     16       NA     NA 0.762</span></span>
<span><span class="co">#&gt; 53            blindRand    factor 734      3       NA     NA 0.317</span></span>
<span><span class="co">#&gt; 54                 bias   numeric 734      9    2.884   0.75    NA</span></span>
<span><span class="co">#&gt; 55                   tV    factor 734     60       NA     NA 0.929</span></span>
<span><span class="co">#&gt; 56              anxiety   integer 734      2    0.486   0.50    NA</span></span>
<span><span class="co">#&gt; 57            sLearning   numeric 734      2    0.277   0.45    NA</span></span>
<span><span class="co">#&gt; 58           nsLearning   numeric 734      2    0.143   0.35    NA</span></span>
<span><span class="co">#&gt; 59               social   integer 734      2    0.063   0.24    NA</span></span>
<span><span class="co">#&gt; 60             multiply   integer 734      2   -0.272   0.96    NA</span></span>
<span><span class="co">#&gt; 61               noMeta   numeric 734      2    0.031   0.17    NA</span></span>
<span><span class="co">#&gt; 62               domain    factor 734      6       NA     NA 0.662</span></span>
<span><span class="co">#&gt; 63        directionQual   numeric 617      4    0.183   0.58    NA</span></span>
<span><span class="co">#&gt; 64                   yi   numeric 734    726    0.243   1.34    NA</span></span>
<span><span class="co">#&gt; 65                   vi   numeric 734    728    0.263   0.36    NA</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="impute-missings">Impute missings<a class="anchor" aria-label="anchor" href="#impute-missings"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bonapersona</span><span class="op">$</span><span class="va">ageWeek</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">bonapersona</span><span class="op">$</span><span class="va">ageWeek</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">bonapersona</span><span class="op">$</span><span class="va">ageWeek</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="moderators">Moderators<a class="anchor" aria-label="anchor" href="#moderators"></a>
</h2>
<p>For this application, we use a smaller selection of moderators than
in Bonapersona et al.Â (2019).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datsel</span> <span class="op">&lt;-</span> <span class="va">bonapersona</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yi"</span>, <span class="st">"vi"</span>, <span class="st">"author"</span>, <span class="st">"mTimeLength"</span>, <span class="st">"year"</span>, <span class="st">"model"</span>, <span class="st">"ageWeek"</span>, <span class="st">"strainGrouped"</span>, <span class="st">"bias"</span>, <span class="st">"species"</span>, <span class="st">"domain"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="two-level-model">Two-level model<a class="anchor" aria-label="anchor" href="#two-level-model"></a>
</h2>
<p>First, for simplicity, we run a two-level model ignoring the fact
that certain effect sizes come from the same study.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat2l</span> <span class="op">&lt;-</span> <span class="va">datsel</span></span>
<span><span class="va">dat2l</span><span class="op">[[</span><span class="st">"author"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<div class="section level3">
<h3 id="two-level-model-with-the-lasso-prior">Two-level model with the lasso prior<a class="anchor" aria-label="anchor" href="#two-level-model-with-the-lasso-prior"></a>
</h3>
<p>We start with running a penalized meta-analysis using the lasso
prior. Compared to the horseshoe prior, the lasso is easier to use
because it has only two hyperparameters to set. However, the lighter
tails of the lasso can result in large coefficients being shrunken too
much towards zero thereby leading to potentially more bias compared to
the regularized horseshoe prior.</p>
<p>For the lasso prior, we need to specify the degrees of freedom
<code>df</code> and the <code>scale</code>. Both default to 1. The
degrees of freedom determines the chi-square prior that is specified for
the inverse-tuning parameter. Increasing the degrees of freedom will
allow larger values for the inverse-tuning parameter, leading to less
shrinkage. Increasing the scale parameter will also result in less
shrinkage. The influence of these hyperparameters can be visualized
through the implemented shiny app, which can be called via
<code><a href="../reference/shiny_prior.html">shiny_prior()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_lasso</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brma.html">brma</a></span><span class="op">(</span><span class="va">yi</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">dat2l</span>,</span>
<span>                  vi <span class="op">=</span> <span class="st">"vi"</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>                  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  mute_stan <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="assessing-convergence-and-interpreting-the-results">Assessing convergence and interpreting the results<a class="anchor" aria-label="anchor" href="#assessing-convergence-and-interpreting-the-results"></a>
</h4>
<p>We can request the results using the <code>summary</code> function.
Before we interpret the results, we need to ensure that the MCMC chains
have converged to the posterior distribution. Two helpful diagnostics
provided in the summary are the number of effective posterior samples
<code>n_eff</code> and the potential scale reduction factor
<code>Rhat</code>. <code>n_eff</code> is an estimate of the number of
independent samples from the posterior. Ideally, the ratio
<code>n_eff</code> to total samples is as close to 1 as possible.
<code>Rhat</code> compares the between- and within-chain estimates and
is ideally close to 1 (indicating the chains have mixed well). Should
any values for <code>n_eff</code> or <code>Rhat</code> be far from these
ideal values, you can try increasing the number of iterations through
the <code>iter</code> argument. By default, the <code>brma</code>
function runs four MCMC chains with 2000 iterations each, half of which
is discarded as burn-in. As a result, a total of 4000 iterations is
available on which posterior summaries are based. If this does not help,
non-convergence might indicate a problem with the model
specification.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_lasso</span><span class="op">)</span></span>
<span><span class="va">sum</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"2.5%"</span>, <span class="st">"97.5%"</span>, <span class="st">"n_eff"</span>, <span class="st">"Rhat"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                                  mean      sd     2.5%   97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; Intercept                    -20.7265 14.4136 -50.9609  3.6187  1657    1</span></span>
<span><span class="co">#&gt; mTimeLength                   -0.0032  0.0048  -0.0143  0.0049  2070    1</span></span>
<span><span class="co">#&gt; year                           0.0104  0.0072  -0.0017  0.0254  1660    1</span></span>
<span><span class="co">#&gt; modelLG                        0.0855  0.1438  -0.1759  0.4025  2283    1</span></span>
<span><span class="co">#&gt; modelLNB                       0.1430  0.1059  -0.0270  0.3721  1210    1</span></span>
<span><span class="co">#&gt; modelM                         0.0213  0.0496  -0.0695  0.1329  2208    1</span></span>
<span><span class="co">#&gt; modelMD                        0.0229  0.0773  -0.1253  0.1856  2320    1</span></span>
<span><span class="co">#&gt; ageWeek                       -0.0073  0.0053  -0.0187  0.0015  1364    1</span></span>
<span><span class="co">#&gt; strainGroupedC57Bl6           -0.0189  0.0662  -0.1587  0.1117  2193    1</span></span>
<span><span class="co">#&gt; strainGroupedCD1              -0.1158  0.1813  -0.5305  0.2004  2074    1</span></span>
<span><span class="co">#&gt; strainGroupedDBA              -0.0253  0.1625  -0.3563  0.3059  1591    1</span></span>
<span><span class="co">#&gt; strainGroupedlisterHooded     -0.0540  0.3135  -0.7133  0.5434  2062    1</span></span>
<span><span class="co">#&gt; strainGroupedlongEvans         0.0712  0.1205  -0.1421  0.3397  2253    1</span></span>
<span><span class="co">#&gt; strainGroupedlongEvansHooded   0.1790  0.2181  -0.1823  0.6557  2302    1</span></span>
<span><span class="co">#&gt; strainGroupedNMRI              0.1200  0.2423  -0.3336  0.6518  2225    1</span></span>
<span><span class="co">#&gt; strainGroupedNS                0.0289  0.1497  -0.2674  0.3448  2842    1</span></span>
<span><span class="co">#&gt; strainGroupedother            -0.0227  0.1263  -0.2832  0.2302  2079    1</span></span>
<span><span class="co">#&gt; strainGroupedspragueDawley    -0.0041  0.0615  -0.1343  0.1176  1921    1</span></span>
<span><span class="co">#&gt; strainGroupedswissWebster      0.5557  0.4900  -0.2266  1.6393  2230    1</span></span>
<span><span class="co">#&gt; strainGroupedwistar            0.0236  0.0567  -0.0807  0.1512  2078    1</span></span>
<span><span class="co">#&gt; strainGroupedwistarKyoto       0.0295  0.2698  -0.5350  0.5813  2392    1</span></span>
<span><span class="co">#&gt; bias                          -0.0086  0.0290  -0.0716  0.0473  2087    1</span></span>
<span><span class="co">#&gt; speciesrat                     0.1191  0.0877  -0.0203  0.3179  1380    1</span></span>
<span><span class="co">#&gt; domainsLearning                0.0017  0.0501  -0.1012  0.1072  1986    1</span></span>
<span><span class="co">#&gt; domainnsLearning               0.1159  0.0815  -0.0215  0.2892  1553    1</span></span>
<span><span class="co">#&gt; domainsocial                   0.1702  0.1183  -0.0249  0.4232  1600    1</span></span>
<span><span class="co">#&gt; domainnoMeta                  -0.3615  0.1843  -0.7299 -0.0184  1212    1</span></span>
<span><span class="co">#&gt; sexM                           0.1205  0.0689  -0.0017  0.2605  1602    1</span></span>
<span><span class="co">#&gt; tau2                           0.4291  0.0394   0.3524  0.5098  1112    1</span></span></code></pre>
<p>If we are satisfied with the convergence, we can continue looking at
the posterior summary statistics. The <code>summary</code> function
provides the posterior mean estimate for the effect of each moderator.
Since Bayesian penalization does not automatically shrink estimates
exactly to zero, some additional criterion is needed to determine which
moderators should be selected in the model. Currently, this is done
using the 95% credible intervals, with a moderator being selected if
zero is excluded in this interval. In the <code>summary</code> this is
denoted by an asterisk for that moderator. In this model, the only
significant moderator is the dummy variable for sex. All other
coefficients are not significant after being shrunken towards zero by
the lasso prior.</p>
<p>Also note the summary statistics for <code>tau2</code>, the
(unexplained) residual between-studies heterogeneity. The 95% credible
interval for this coefficient excludes zero, indicating that there is a
non-zero amount of unexplained heterogeneity. It is customary to express
this heterogeneity in terms of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>I</mi><mn>2</mn></msup><annotation encoding="application/x-tex">I^2</annotation></semantics></math>,
the percentage of variation across studies that is due to heterogeneity
rather than chance (Higgins and Thompson, 2002; Higgins et al., 2003).
The helper function <code><a href="../reference/I2.html">I2()</a></code> computes the posterior
distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>I</mi><mn>2</mn></msup><annotation encoding="application/x-tex">I^2</annotation></semantics></math>
based on the MCMC draws of <code>tau2</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/I2.html">I2</a></span><span class="op">(</span><span class="va">fit_lasso</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    mean sd 2.5% 25% 50% 75% 97.5%</span></span>
<span><span class="co">#&gt; I2   68  2   64  67  68  69    72</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="two-level-model-with-the-horseshoe-prior">Two-level model with the horseshoe prior<a class="anchor" aria-label="anchor" href="#two-level-model-with-the-horseshoe-prior"></a>
</h3>
<p>Next, we look into the regularized horseshoe prior. The horseshoe
prior has five hyperparameters that can be set. Three parameters are
degrees of freedom parameters which influence the tails of the
distributions in the prior. Generally, it is not needed to specify
different values for these hyperparameters. Here, we focus instead on
the global scale parameter and the scale of the slab.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use the default settings</span></span>
<span><span class="va">fit_hs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brma.html">brma</a></span><span class="op">(</span><span class="va">yi</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                data <span class="op">=</span> <span class="va">dat2l</span>,</span>
<span>                vi <span class="op">=</span> <span class="st">"vi"</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"hs"</span>,</span>
<span>                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, df_global <span class="op">=</span> <span class="fl">1</span>, df_slab <span class="op">=</span> <span class="fl">4</span>, scale_global <span class="op">=</span> <span class="fl">1</span>, scale_slab <span class="op">=</span> <span class="fl">1</span>, relevant_pars <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>                mute_stan <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reduce the global scale</span></span>
<span><span class="va">fit_hs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brma.html">brma</a></span><span class="op">(</span><span class="va">yi</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                data <span class="op">=</span> <span class="va">dat2l</span>,</span>
<span>                vi <span class="op">=</span> <span class="st">"vi"</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"hs"</span>,</span>
<span>                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, df_global <span class="op">=</span> <span class="fl">1</span>, df_slab <span class="op">=</span> <span class="fl">4</span>, scale_global <span class="op">=</span> <span class="fl">0.1</span>, scale_slab <span class="op">=</span> <span class="fl">1</span>, relevant_pars <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>                mute_stan <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># increase the scale of the slab</span></span>
<span><span class="va">fit_hs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brma.html">brma</a></span><span class="op">(</span><span class="va">yi</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                data <span class="op">=</span> <span class="va">dat2l</span>,</span>
<span>                vi <span class="op">=</span> <span class="st">"vi"</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"hs"</span>,</span>
<span>                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, df_global <span class="op">=</span> <span class="fl">1</span>, df_slab <span class="op">=</span> <span class="fl">4</span>, scale_global <span class="op">=</span> <span class="fl">1</span>, scale_slab <span class="op">=</span> <span class="fl">5</span>, relevant_pars <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>                mute_stan <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Note that the horseshoe prior results in some divergent transitions.
This can be an indication of non-convergence. However, these divergences
arise often when using the horseshoe prior and as long as there are not
too many of them, the results can still be
used.<!-- CJ Reference? --></p>
<p>Next, we plot the posterior mean estimates for a selection of
moderators for the different priors.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_plotdat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span>, <span class="va">prior</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">plotdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span></span>
<span>  <span class="va">plotdat</span><span class="op">$</span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">plotdat</span><span class="op">)</span></span>
<span>  <span class="va">plotdat</span><span class="op">$</span><span class="va">Prior</span> <span class="op">&lt;-</span> <span class="va">prior</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plotdat</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df0</span> <span class="op">&lt;-</span> <span class="fu">make_plotdat</span><span class="op">(</span><span class="va">fit_lasso</span>, prior <span class="op">=</span> <span class="st">"lasso"</span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu">make_plotdat</span><span class="op">(</span><span class="va">fit_hs1</span>, prior <span class="op">=</span> <span class="st">"hs default"</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">make_plotdat</span><span class="op">(</span><span class="va">fit_hs2</span>, prior <span class="op">=</span> <span class="st">"hs reduced global scale"</span><span class="op">)</span></span>
<span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu">make_plotdat</span><span class="op">(</span><span class="va">fit_hs3</span>, prior <span class="op">=</span> <span class="st">"hs increased slab scale"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span><span class="va">df0</span>, <span class="va">df1</span>, <span class="va">df2</span>, <span class="va">df3</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="va">df</span><span class="op">$</span><span class="va">par</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="st">"tau2"</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mean</span>, y<span class="op">=</span><span class="va">par</span>, group <span class="op">=</span> <span class="va">Prior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="va">X2.5.</span>, xmax<span class="op">=</span><span class="va">X97.5.</span>, colour <span class="op">=</span> <span class="va">Prior</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">.1</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">Prior</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="va">pd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Posterior mean"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="sensitivity.png" width="80%"></p>
<p>We can see that, in general, the different priors give quite similar
results in this application. A notable exception is the estimate for the
dummy variable <code>testAuthorGrouped_stepDownAvoidance</code> which is
much smaller for the lasso compared to the horseshoe specification. This
indicates that the lasso can shrink large coefficients more towards zero
whereas the horseshoe is better at keeping them large.</p>
</div>
</div>
<div class="section level2">
<h2 id="three-level-model">Three-level model<a class="anchor" aria-label="anchor" href="#three-level-model"></a>
</h2>
<p>Finally, we can also take into account the fact that some effect
sizes might come from the same study by fitting a three-level model as
follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_3l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brma.html">brma</a></span><span class="op">(</span><span class="va">yi</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>               data <span class="op">=</span> <span class="va">datsel</span>,</span>
<span>               vi <span class="op">=</span> <span class="st">"vi"</span>,</span>
<span>               study <span class="op">=</span> <span class="st">"author"</span>,</span>
<span>               method <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>               standardize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>               mute_stan <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="standardization">Standardization<a class="anchor" aria-label="anchor" href="#standardization"></a>
</h2>
<p>It is possible to override the default standardization, which
standardizes all variables (including dummies). To do so, first manually
standardize any variables that must be standardized. Then, in the call
to <code><a href="../reference/brma.html">brma()</a></code>, provide a named list with elements
<code>list(center = ..., scale = ...)</code>. For variables that are
<strong>not</strong> to be standardized, use
<code>center = 0, scale = 1</code>. This retains their original scale.
For variables that are to be standardized, use their original
<code>center</code> and <code>scale</code> to restore the coefficients
to their original scale.</p>
<p>In the example below, we standardize a continuous predictor, but we
do not standardize the dummies:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moderators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">yi</span><span class="op">~</span><span class="va">ageWeek</span> <span class="op">+</span> <span class="va">strainGrouped</span>, data <span class="op">=</span> <span class="va">datsel</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">scale_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">moderators</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">stdz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">scale_age</span>, <span class="st">"scaled:center"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">datsel</span><span class="op">$</span><span class="va">strainGrouped</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">scale_age</span>, <span class="st">"scaled:scale"</span><span class="op">)</span>,   <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">datsel</span><span class="op">$</span><span class="va">strainGrouped</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">moderators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">datsel</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yi"</span>, <span class="st">"vi"</span>, <span class="st">"author"</span><span class="op">)</span><span class="op">]</span>, <span class="va">moderators</span><span class="op">)</span></span>
<span><span class="va">fit_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brma.html">brma</a></span><span class="op">(</span><span class="va">yi</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                data <span class="op">=</span> <span class="va">moderators</span>,</span>
<span>                vi <span class="op">=</span> <span class="st">"vi"</span>,</span>
<span>                study <span class="op">=</span> <span class="st">"author"</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                standardize <span class="op">=</span> <span class="va">stdz</span>,</span>
<span>                mute_stan <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Note that, in this example, only <code>ageWeek</code> is
standardized; the remaining (dummy) variables are untouched. The object
<code>stdz</code> provides the original center and scale for
<code>ageWeek</code>, which allows <code><a href="../reference/brma.html">brma()</a></code> to properly
rescale the coefficient for this moderator. As the center and scale for
all remaining (dummy) variables are 0 and 1, these coefficients are
<strong>not</strong> rescaled. See the <code>pema</code> paper for a
discussion of standardization and further references.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Caspar J van Lissa, Sara J van Erp.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
