<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Conduct Bayesian Regularized Meta-Analysis — brma • pema</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Conduct Bayesian Regularized Meta-Analysis — brma"><meta name="description" content="This function conducts Bayesian regularized meta-regression (Van Lissa &amp;amp; Van
Erp, 2021). It uses the stan function
rstan::sampling to fit the model. A lasso or horseshoe prior is used to
shrink the regression coefficients of irrelevant moderators towards zero.
See Details."><meta property="og:description" content="This function conducts Bayesian regularized meta-regression (Van Lissa &amp;amp; Van
Erp, 2021). It uses the stan function
rstan::sampling to fit the model. A lasso or horseshoe prior is used to
shrink the regression coefficients of irrelevant moderators towards zero.
See Details."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pema</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/meta-analysis_tutorial.html">Tutorial: Machine Learning-Informed Meta-Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/using-brma.html">Conducting a Bayesian Regularized Meta-analysis</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cjvanlissa/pema/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Conduct Bayesian Regularized Meta-Analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/cjvanlissa/pema/blob/master/R/brma.R" class="external-link"><code>R/brma.R</code></a></small>
      <div class="d-none name"><code>brma.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function conducts Bayesian regularized meta-regression (Van Lissa &amp; Van
Erp, 2021). It uses the <code>stan</code> function
rstan::sampling to fit the model. A lasso or horseshoe prior is used to
shrink the regression coefficients of irrelevant moderators towards zero.
See Details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">brma</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">brma</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  vi <span class="op">=</span> <span class="st">"vi"</span>,</span>
<span>  study <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"hs"</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prior <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">method</span>, lasso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, hs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span>, df_global <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    df_slab <span class="op">=</span> <span class="fl">4</span>, scale_global <span class="op">=</span> <span class="fl">1</span>, scale_slab <span class="op">=</span> <span class="fl">2</span>, relevant_pars <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mute_stan <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">brma</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">vi</span>,</span>
<span>  study <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"hs"</span>,</span>
<span>  <span class="va">standardize</span>,</span>
<span>  <span class="va">prior</span>,</span>
<span>  mute_stan <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">intercept</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An k x m numeric matrix, where k is the number of effect sizes and m
is the number of moderators.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed on to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code>.
Use this, e.g., to override default arguments of that function.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>An object of class <code>formula</code> (or one that can be coerced to
that class), see <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Either a <code>data.frame</code> containing the variables in the model,
see <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>, or a <code>list</code> of multiple imputed <code>data.frame</code>s,
or an object returned by <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></code>.</p></dd>


<dt id="arg-vi">vi<a class="anchor" aria-label="anchor" href="#arg-vi"></a></dt>
<dd><p>Character. Name of the column in the <code>data</code> that
contains the variances of the effect sizes. This column will be removed from
the data prior to analysis. Defaults to <code>"vi"</code>.</p></dd>


<dt id="arg-study">study<a class="anchor" aria-label="anchor" href="#arg-study"></a></dt>
<dd><p>Character. Name of the column in the
<code>data</code> that contains the study id. Use this when the data includes
multiple effect sizes per study. This column can be a vector of integers, or
a factor. This column will be removed from the data prior to analysis.
See <code>Details</code> for more information about analyzing dependent data.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character, indicating the type of regularizing prior to use.
Supports one of <code>c("hs", "lasso")</code>, see Details. Defaults to
<code>"hs"</code>.</p></dd>


<dt id="arg-standardize">standardize<a class="anchor" aria-label="anchor" href="#arg-standardize"></a></dt>
<dd><p>Either a logical argument or a list. If <code>standardize</code> is
logical, it controls whether all predictors are standardized prior to
analysis or not. Parameter estimates are restored to the predictors' original
scale. Alternatively, users can provide a list to <code>standardize</code> to gain
more control over the standardization process. In this case, it is assumed
that the standardization has already taken place. This list must have two
elements: <code>list(center = c(mean(X1) , mean(X2), mean(X...)), scale = c(sd(X1), sd(X2), sd(X...)))</code>. It is used
only to restore parameter estimates to the original scale of the predictors.
This is useful, e.g., to standardize continuous and dichotomous variables
separately. Defaults to <code>TRUE</code>, which is recommended so that shrinking
affects all parameters similarly.</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>Numeric vector, specifying the prior to use. Note that the
different <code>method</code>s require this vector to contain specific named
elements.</p></dd>


<dt id="arg-mute-stan">mute_stan<a class="anchor" aria-label="anchor" href="#arg-mute-stan"></a></dt>
<dd><p>Logical, indicating whether mute all 'Stan' output or not.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A numeric vector of k effect sizes.</p></dd>


<dt id="arg-intercept">intercept<a class="anchor" aria-label="anchor" href="#arg-intercept"></a></dt>
<dd><p>Logical, indicating whether or not an intercept should be included
in the model.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>list</code> object of class <code>brma</code>, with the following structure:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  fit          <span class="co"># An object of class stanfit, for compatibility with rstan</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  coefficients <span class="co"># A numeric matrix with parameter estimates; these are</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>               <span class="co"># interpreted as regression coefficients, except tau2 and tau,</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>               <span class="co"># which are interpreted as the residual variance and standard</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>               <span class="co"># deviation, respectively.</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  formula      <span class="co"># The formula used to estimate the model</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  terms        <span class="co"># The predictor terms in the formula</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  X            <span class="co"># Numeric matrix of moderator variables</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  Y            <span class="co"># Numeric vector with effect sizes</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  vi           <span class="co"># Numeric vector with effect size variances</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  tau2         <span class="co"># Numeric, estimated tau2</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  R2           <span class="co"># Numeric, estimated heterogeneity explained by the moderators</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  k            <span class="co"># Numeric, number of effect sizes</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  study        <span class="co"># Numeric vector with study id numbers</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>)</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Bayesian regularized meta-analysis algorithm (Van Lissa &amp; Van
Erp, 2021) penalizes meta-regression coefficients either via the
lasso prior (Park &amp; Casella, 2008) or the regularized horseshoe prior
(Piironen &amp; Vehtari, 2017).</p><dl><dt>lasso</dt>
<dd><p>The Bayesian equivalent of the lasso penalty is obtained when
placing independent Laplace (i.e., double exponential) priors on the
regression coefficients centered around zero. The scale of the Laplace
priors is determined by a global scale parameter <code>scale</code>, which
defaults to 1 and an inverse-tuning parameter \(\frac{1}{\lambda}\)
which is given a chi-square prior governed by a degrees of freedom
parameter <code>df</code> (defaults to 1). If <code>standardize = TRUE</code>,
shrinkage will
affect all coefficients equally and it is not necessary to adapt the
<code>scale</code> parameter. Increasing the <code>df</code> parameter will allow
larger values for the inverse-tuning parameter, leading to less shrinkage.</p></dd>

<dt>hs</dt>
<dd><p>One issue with the lasso prior is that it has relatively light
tails. As a result, not only does the lasso have the desirable behavior of
pulling small coefficients to zero, it also results in too much shrinkage
of large coefficients. An alternative prior that improves upon this
shrinkage pattern is the horseshoe prior (Carvalho, Polson &amp; Scott, 2010).
The horseshoe prior has an infinitely large spike at zero, thereby pulling
small coefficients toward zero but in addition has fat tails, which allow
substantial coefficients to escape the shrinkage. The regularized horseshoe
is an extension of the horseshoe prior that allows the inclusion of prior
information regarding the number of relevant predictors and can
be more numerically stable in certain cases (Piironen &amp; Vehtari, 2017).
The regularized horseshoe has a global shrinkage parameter that influences
all coefficients similarly and local shrinkage parameters that enable
flexible shrinkage patterns for each coefficient separately. The local
shrinkage parameters are given a Student's t prior with a default <code>df</code>
parameter of 1. Larger values for <code>df</code> result in lighter tails and
a prior that is no longer strictly a horseshoe prior. However, increasing
<code>df</code> slightly might be necessary to avoid divergent transitions in
Stan (see also <a href="https://mc-stan.org/misc/warnings.html" class="external-link">https://mc-stan.org/misc/warnings.html</a>). Similarly,
the degrees of freedom for the Student's t prior on the global shrinkage
parameter <code>df_global</code> can be increased from the default of 1 to, for
example, 3 if divergent transitions occur although the resulting
prior is then strictly no longer a horseshoe. The scale for the Student's t
prior on the global shrinkage parameter <code>scale_global</code> defaults to 1
and can be decreased to achieve more shrinkage. Moreover, if prior
information regarding the number of relevant moderators is available, it is
recommended to include this information via the <code>relevant_pars</code>
argument by setting it to the expected number of relevant moderators. When
<code>relevant_pars</code> is specified, <code>scale_global</code> is ignored and
instead based on the available prior information. Contrary to the horseshoe
prior, the regularized horseshoe applies additional regularization on large
coefficients which is governed by a Student's t prior with a
<code>scale_slab</code> defaulting to 2 and <code>df_slab</code> defaulting to 4.
This additional regularization ensures at least some shrinkage of large
coefficients to avoid any sampling problems.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Van Lissa, C. J., van Erp, S., &amp; Clapper, E. B. (2023). Selecting relevant
moderators with Bayesian regularized meta-regression. Research Synthesis
Methods. <a href="https://doi.org/10.31234/osf.io/6phs5" class="external-link">doi:10.31234/osf.io/6phs5</a></p>
<p>Park, T., &amp; Casella, G. (2008). The Bayesian Lasso. Journal of the American
Statistical Association, 103(482), 681–686. <a href="https://doi.org/10.1198/016214508000000337" class="external-link">doi:10.1198/016214508000000337</a></p>
<p>Carvalho, C. M., Polson, N. G., &amp; Scott, J. G. (2010). The horseshoe
estimator for sparse signals. Biometrika, 97(2), 465–480.
<a href="https://doi.org/10.1093/biomet/asq017" class="external-link">doi:10.1093/biomet/asq017</a></p>
<p>Piironen, J., &amp; Vehtari, A. (2017). Sparsity information and regularization
in the horseshoe and other shrinkage priors. Electronic Journal of
Statistics, 11(2). <a href="https://projecteuclid.org/journals/electronic-journal-of-statistics/volume-11/issue-2/Sparsity-information-and-regularization-in-the-horseshoe-and-other-shrinkage/10.1214/17-EJS1337SI.pdf" class="external-link">https://projecteuclid.org/journals/electronic-journal-of-statistics/volume-11/issue-2/Sparsity-information-and-regularization-in-the-horseshoe-and-other-shrinkage/10.1214/17-EJS1337SI.pdf</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"curry"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">curry</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">50</span><span class="op">:</span><span class="fl">55</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"vi"</span>, <span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"donorcode"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">{</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">brma</span><span class="op">(</span><span class="va">d</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">df</span>, iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Caspar J van Lissa, Sara J van Erp.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

